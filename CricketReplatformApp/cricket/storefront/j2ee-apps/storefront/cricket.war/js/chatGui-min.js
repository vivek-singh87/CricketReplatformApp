function chatGui(e,t){this.chatStartRequested=false;this.startOnFirstLine=false;this.startLine="";this.ver="0.5";this.conf=e;this.chatConf=t;this.randomNum=Math.round(1e3*Math.random());this.cssTemplate="";this.htmlTemplate="<div id='chatboxcontent-{RANDOM}' class='chatboxcontent ui-corner-all'>         </div>         <div class='chatboxtextareaDiv'>            <textarea id='chatboxtextarea-{RANDOM}' class='chatboxtextarea ui-corner-all inputFocus'></textarea>         </div>    </div>";this.lpc=null;this.chatCookie="CHATCOOKIE-"+t.lpNumber;this.baseTitle="Chat"}chatGui.prototype.hideDiv=function(){$("#"+this.conf.divID).hide("slow")};chatGui.prototype.adjustContentHeight=function(e){if(typeof e=="undefined"){e=$("#"+this.conf.divID).height()-77}else{e=e-77}if(e<20){e=20}$(".chatboxcontent").height(e)};chatGui.prototype.populateDiv=function(e){if(typeof e=="undefined"){e=false}var t=this.cssTemplate+this.htmlTemplate.replace(/\{RANDOM\}/g,this.randomNum);$("#"+this.conf.divID).html(t);if(e&&this.conf.rememberPosition){var n=this.parseCookie();if(n.height){$("#"+this.conf.divID).css({height:n.height+"px",width:n.width+"px"})}else{$("#"+this.conf.divID).height(this.conf.height);$("#"+this.conf.divID).width(this.conf.width)}if(n.left){$("#"+this.conf.divID).css({position:"absolute",left:n.left+"px",top:n.top+"px"})}this.adjustContentHeight(n.height)}else{$("#"+this.conf.divID).height(this.conf.height);$("#"+this.conf.divID).width(this.conf.width);this.adjustContentHeight();$("#"+this.conf.divID).show("slow")}var r=this;if(this.conf.resizable){$("#"+this.conf.divID).resizable({resize:function(e,t){r.myOnResize()},stop:function(e,t){r.myOnResizeStop()}})}$("#chatbox-"+this.randomNum).show("slow")};chatGui.prototype.init=function(){if(this.conf.autoStart||this.isResumeChat()){this.startChat()}};chatGui.prototype.initUIChat=function(){this.startOnFirstLine=true;this.lpc=window.lpc;var e=this.isResumeChat();this.populateDiv(e);this.attachEvents()};chatGui.prototype.startChat=function(){this.commenceChat()};chatGui.prototype.commenceChat=function(){var e=this;this.lpc=window.lpc;if(typeof lpChat!="undefined"){if(typeof window.lpChatConfig=="undefined"){window.lpChatConfig={}}this.lpc.onInit=$(function(){e.myInitHandler()});this.lpc.onStart=$(function(t,n){e.myOnStart(t,n)});this.lpc.onAvailability=$(function(t){e.myOnAvailability(t)});this.lpc.onStop=$(function(t,n){e.myStopChat(t,n)});this.lpc.onState=$(function(t){e.myOnState(t)});this.lpc.onAgentTyping=$(function(t){e.myTypingHandler(t)});this.lpc.onUrlPush=$(function(t){e.myPushHandler(t)});this.lpc.onLine=$(function(t){e.myLineHandler(t)});this.lpc.onError=$(function(t){e.myErrorHandler(t)});for(var t in this.chatConf){this.lpc[t]=this.chatConf[t]}}else{alert("lpChat undefined");throw{message:"lpChat undefined"}}var n=this.isResumeChat();this.populateDiv(n);this.attachEvents();if(n){var r=this.parseCookie();this.lpc.sessionkey=r.sessionkey;this.lpc.startChatSequence();e.scrollToBottom()}else{this.lpc.requestChat()}};chatGui.prototype.myOnAvailability=function(e){if(e.availability==true){alert("we can start a chat")}else{this.addLineFromSystem("account is offline")}};chatGui.prototype.isResumeChat=function(){var e=this.parseCookie();this.log("isResumeChat:"+(e.sessionkey?true:false));return e.sessionkey?true:false};chatGui.prototype.scrollToBottom=function(){var e=$("#chatboxcontent-"+this.randomNum);if(e){e.scrollTop(e[0].scrollHeight)}};chatGui.prototype.attachEvents=function(){var e=this;$("#chatboxtextarea-"+this.randomNum).bind("focus",function(e){$(this).removeClass("inputNoFocus");$(this).addClass("inputFocus")});$("#chatboxtextarea-"+this.randomNum).bind("blur",function(e){});$("#chatboxtextarea-"+this.randomNum).bind("keydown",function(t){if(e.startOnFirstLine&&t.keyCode==13&&t.shiftKey==0&&e.lpc.getState().id!=2&&!e.chatStartRequested){e.chatStartRequested=true;e.startChat();e.startLine=$(this).val();$(this).val("");return false}if(t.keyCode==13&&t.shiftKey==0&&e.lpc.getState().id==2){e.addLine($(this).val());$(this).val("");return false}if(e.lpc.getState().id!=2&&(e.chatStartRequested||!e.startOnFirstLine)){if(t.keyCode==13&&t.shiftKey==0){e.addLine($(this).val());$(this).val("");return false}}return true});$("#chatboxcontent-"+this.randomNum).bind("click",function(t){$("#chatboxtextarea-"+e.randomNum).focus()});$("#chatBoxCloseChat-"+this.randomNum).bind("click",function(t){e.lpc.endChat();e.hideDiv();e.deleteCookie(e.chatCookie)})};chatGui.prototype.addLineFromSystem=function(e,t){if(this.conf.maskVisitorDataRegExp){var n=new RegExp(this.conf.maskVisitorDataRegExp);e=e.replace(n,this.conf.maskVisitorDataReplace)}if(!t&&this.conf.enableGoogleTranslate){var r=this;google.language.translate(e,this.conf.googleTranslateVisitorTargetLanguage,this.conf.googleTranslateAgentTargetLanguage,function(t){var n="";if(!t.error){if(t.detectedSourceLanguage!=r.conf.googleTranslateAgentTargetLanguage){var i=e;if(e!=t.translation){n="("+r.conf.googleTranslateAgentTargetLanguage+": "+t.translation+")"}}}i+=" "+n;r.myLineHandler({by:"LivePerson System",text:e,translation:n,type:r.lpc.LineType.SYSTEM});r.lpc.addLine(i)})}else{this.myLineHandler({by:"LivePerson System",text:e,type:this.lpc.LineType.SYSTEM});this.lpc.addLine(e)}};chatGui.prototype.addLine=function(e,t){if(this.conf.maskVisitorDataRegExp){var n=new RegExp(this.conf.maskVisitorDataRegExp);e=e.replace(n,this.conf.maskVisitorDataReplace)}if(!t&&this.conf.enableGoogleTranslate){var r=this;google.language.translate(e,this.conf.googleTranslateVisitorTargetLanguage,this.conf.googleTranslateAgentTargetLanguage,function(t){var n="";if(!t.error){if(t.detectedSourceLanguage!=r.conf.googleTranslateAgentTargetLanguage){var i=e;if(e!=t.translation){n="("+r.conf.googleTranslateAgentTargetLanguage+": "+t.translation+")"}}}i+=" "+n;r.myLineHandler({by:r.lpc.getVisitorName(),text:e,translation:n,type:r.lpc.LineType.VISITOR});r.lpc.addLine(i)})}else{this.myLineHandler({by:this.lpc.getVisitorName(),text:e,type:this.lpc.LineType.VISITOR});this.lpc.addLine(e)}};chatGui.prototype.myOnDrag=function(){this.dragged=true;this.updateCookie();var e=$("#"+this.conf.divID).position();$("#"+this.conf.divID).css({position:"absolute",left:Math.ceil(e.left)+"px",top:Math.ceil(e.top)+"px"})};chatGui.prototype.myOnResizeStop=function(){this.updateCookie()};chatGui.prototype.myOnResize=function(){this.adjustContentHeight();if($("#"+this.conf.divID).width()<120){$("#"+this.conf.divID).width(120)}if($("#"+this.conf.divID).height()<120){$("#"+this.conf.divID).height(120)}this.resized=true};chatGui.prototype.parseCookie=function(){var e={};var t=this.getCookie(this.chatCookie);if(t!=null){var n=t.split("|");for(var r=0;r<n.length;r++){var i=n[r].split("#");e[i[0]]=i[1]}if(e.height){e.height=parseInt(e.height)}if(e.width){e.width=parseInt(e.width)}if(e.top){e.top=parseInt(e.top)}if(e.left){e.left=parseInt(e.left)}}return e};chatGui.prototype.updateCookie=function(){var e="";if(this.conf.autoResumechat&&this.lpc.sessionkey!=-1){e+="sessionkey#"+this.lpc.sessionkey+"|"}if(this.conf.rememberPosition){if(this.conf.resizable&&this.resized){e+="height#"+Math.ceil($("#"+this.conf.divID).height())+"|";e+="width#"+Math.ceil($("#"+this.conf.divID).width())+"|"}if(this.conf.draggable&&this.dragged){var t=$("#"+this.conf.divID).position();e+="left#"+Math.ceil(t.left)+"|";e+="top#"+Math.ceil(t.top)+"|"}}if(e.length>0){e=e.substr(0,e.length-1)}this.setCookie(this.chatCookie,e)};chatGui.prototype.myInitHandler=function(){var e=new Image;e.src="img/smile.png";e.src="img/laugh.png";e.src="img/unhappy.png";if(typeof this.conf.onInit!="undefined"){this.conf.onInit()}if(typeof this.conf.visitor!="undefined"){this.lpc.setVisitorName(this.conf.visitor)}};chatGui.prototype.myOnStart=function(e,t){this.updateCookie();this.baseTitle="Agent "+this.lpc.getAgentName();this.setTitle(this.baseTitle);if(typeof this.conf.onStart!="undefined"){this.conf.onStart(e,t)}};chatGui.prototype.myStopChat=function(e,t){this.deleteCookie(this.chatCookie);if(typeof this.conf.onStop!="undefined"){this.conf.onStop(e,t);this.log("myStopChat:"+e+" "+t)}};chatGui.prototype.myOnState=function(e){var t=e.id;if(t==1){this.setTitle("Chat Initializing")}else if(t==2){this.setTitle("Chat Started");if(this.startOnFirstLine){this.addLine(this.startLine)}}else if(t==4){this.setTitle("Waiting for Chat")}else if(t==6){}};chatGui.prototype.myTypingHandler=function(e){if(e){this.setTitle(this.getTitle()+" is Typing")}else{this.setTitle(this.baseTitle)}};chatGui.prototype.myPushHandler=function(e){};chatGui.prototype.myLineHandler=function(e){if($("#chatboxcontent-"+this.randomNum).length==0){setTimeout(function(){window.chatG.myLineHandler(e)},2e3);return}for(var t in e){if(t=="by")console.log(t+": "+e[t])}if(!e.by){return}var n="";var r="";if(this.conf.showTime){var i;if(e.time){i=new Date(parseInt(e.time)*1e3)}else{i=new Date}r="["+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds()+"] "}if(e.type==this.lpc.LineType.VISITOR){var s=e.text;s=this.addEmoticons(s);if(e.translation){s=s+'<span class="chatboxmessageTranslated"> '+e.translation+"</span>"}n='<div class="chatboxmessage"><span class="chatboxmessagefromVisitor">'+r+e.by+':&nbsp;</span><span class="chatboxmessagecontentVisitor">'+s+"</span></div>"}else if(e.type==this.lpc.LineType.AGENT){if(this.conf.enableGoogleTranslate){var o=this;google.language.translate(e.text,this.conf.googleTranslateAgentTargetLanguage,this.conf.googleTranslateVisitorTargetLanguage,function(t){if(!t.error){if(t.detectedSourceLanguage!=o.conf.googleTranslateVisitorTargetLanguage){var n=e.text+' <span class="chatboxmessageTranslated"> ('+o.conf.googleTranslateVisitorTargetLanguage+": "+t.translation+")</span>";e.text=n;o.showLineFromAgent(e,r)}}})}else{this.showLineFromAgent(e,r)}return}else if(e.type==this.lpc.LineType.SYSTEM){n='<div class="chatboxmessage"><span class="chatboxmessagefromSystem">'+r+e.by+':&nbsp;</span><span class="chatboxmessagecontentSystem">'+e.text+"</span></div>"}else{n='<div class="chatboxmessage"><span class="chatboxmessagefrom">'+r+e.by+':&nbsp;</span><span class="chatboxmessagecontent">'+e.text+"</span></div>";this.log("NO TYPE")}$("#chatboxcontent-"+this.randomNum).append(n);this.scrollToBottom()};chatGui.prototype.showLineFromAgent=function(e,t){var n=e.text;n=this.addEmoticons(n);var r='<div class="chatboxmessage"><span class="chatboxmessagefromAgent">'+t+e.by+':&nbsp;</span><span class="chatboxmessagecontentAgent">'+n+"</span></div>";if(typeof this.lpc.getAgentName()=="undefined"||this.lpc.getAgentName()==""){this.lpc.agent=e.by;this.baseTitle="Agent "+this.lpc.getAgentName();this.setTitle(this.baseTitle)}$("#chatboxcontent-"+this.randomNum).append(r);this.scrollToBottom()};chatGui.prototype.addEmoticons=function(e){e=e.replace(/\:\)\)/g,"<img src='img/laugh.png' border=0 width='13px' height='13px' />");e=e.replace(/\:\)/g,"<img src='img/smile.png' border=0 width='13px' height='13px' />");e=e.replace(/\:\(/g,"<img src='img/unhappy.png' border=0 width='13px' height='13px' />");return e};chatGui.prototype.myErrorHandler=function(e){this.log("ERROR:"+e.id);for(var t in e){this.log(t+" error: "+e[t])}$("#chatboxcontent-"+this.randomNum).append('<div class="chatboxmessage"><span class="chatboxmessagefromError">'+Error+':&nbsp;</span><span class="chatboxmessagecontentError">Error #'+e+" occured.</span></div>")};chatGui.prototype.setTitle=function(e){$("#chatboxhead-"+this.randomNum).html(e)};chatGui.prototype.getTitle=function(){return $("#chatboxhead-"+this.randomNum).html()};chatGui.prototype.getCookie=function(e){var t=document.cookie.indexOf(e+"=");var n=t+e.length+1;if(!t&&e!=document.cookie.substring(0,e.length)){return null}if(t==-1){return null}var r=document.cookie.indexOf(";",n);if(r==-1){r=document.cookie.length}return unescape(document.cookie.substring(n,r))};chatGui.prototype.setCookie=function(e,t,n,r){var i=new Date;i.setTime(i.getTime());if(n){n=n*1e3*60*60*24}var s=new Date(i.getTime()+n);this.log("VALUE:"+t);document.cookie=e+"="+escape(t)+(n?";expires="+s.toGMTString():"")+(r?";path="+r:"")};chatGui.prototype.dir=function(e){};chatGui.prototype.log=function(e){if(typeof console!="undefined")console.log(e)};chatGui.prototype.deleteCookie=function(e){if(this.getCookie(e)){document.cookie=e+"="+";expires=Thu, 01-Jan-1970 00:00:01 GMT"}}